"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_validationError=_interopRequireDefault(require("../validationError"));function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){(0,_defineProperty2.default)(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}var AggregateCommandHandler=function(){function r(e){var s=this;(0,_classCallCheck2.default)(this,r),(0,_defineProperty2.default)(this,"handle",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var n,a,u,o,i;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new s.Command(r),e.next=3,n.validate();case 3:return e.next=5,s.authorize(n,t);case 5:return e.next=7,s.validate(n,t);case 7:return e.next=9,s.execute(n,t);case 9:return a=e.sent,r.$scheduler=n.$scheduler,o=(u=a||{}).events,i=(0,_objectWithoutProperties2.default)(u,["events"]),o||(o=a,i=null),(o=asArray(o)).forEach(function(e){e.actor=n.$identity&&n.$identity.userId,e.position=n.$position}),o=t.applyEvents(o),e.abrupt("return",_objectSpread({events:o},i));case 17:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),(0,_defineProperty2.default)(this,"execute",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),(0,_defineProperty2.default)(this,"authorize",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),(0,_defineProperty2.default)(this,"handleDeliveryError",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.error instanceof _validationError.default?r.cancel():r.retry();case 1:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}()),this.Command=e}return(0,_createClass2.default)(r,[{key:"validate",value:function(){}}]),r}();function asArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return(Array.isArray(e)?e:[e]).filter(function(e){return!!e})}exports.default=AggregateCommandHandler;
//# sourceMappingURL=../maps/commandHandling/aggregateCommandHandler.js.map
