"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_identity=_interopRequireDefault(require("../auth/identity")),_schedule=_interopRequireDefault(require("./schedule")),_commandFailure=_interopRequireWildcard(require("./commandFailure")),_tasks=require("@google-cloud/tasks"),TaskScheduler=function e(r){var d=this,t=r.credentials,a=r.deliveryPath,i=r.location,u=void 0===i?"us-central1":i,l=r.project,n=r.queue,o=r.rootUrl;(0,_classCallCheck2.default)(this,e),(0,_defineProperty2.default)(this,"schedule",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){var t,a,i,u,l,n,o,s,c;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.aggregate,a=r.service,i=r.target,u=r.seconds,(l=r.command).$identity=_identity.default.system,l.$scheduler=new _schedule.default({service:a||t,target:i}),n=d.client.queuePath(d.project,d.location,d.queue),o={httpRequest:{httpMethod:"POST",url:d.deliveryUrl,body:Buffer.from(JSON.stringify(l)).toString("base64")}},u&&(o.scheduleTime={seconds:Date.now()/1e3+u}),e.prev=6,console.log("creating gcloud task",o),e.next=10,d.client.createTask({parent:n,task:o});case 10:s=e.sent,c=(0,_slicedToArray2.default)(s,1),c[0],console.log("created gcloud task"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),console.error("Error creating Gcloud Task",e.t0);case 19:case"end":return e.stop()}},e,null,[[6,16]])}));return function(e){return r.apply(this,arguments)}}()),this.project=l,this.queue=n,this.location=u,this.deliveryUrl="".concat(o,"/").concat(a),this.client=new _tasks.v2beta3.CloudTasksClient({credentials:t})};exports.default=TaskScheduler;
//# sourceMappingURL=../maps/commandScheduling/taskScheduler.js.map
