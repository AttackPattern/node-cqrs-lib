"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_identity=_interopRequireDefault(require("../auth/identity")),_schedule=_interopRequireDefault(require("./schedule")),_commandFailure=_interopRequireWildcard(require("./commandFailure")),_tasks=require("@google-cloud/tasks"),TaskScheduler=function e(r){var d=this,t=r.deliveryUrl,i=r.project,a=r.queue,u=r.location,l=r.credentials;(0,_classCallCheck2.default)(this,e),(0,_defineProperty2.default)(this,"schedule",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){var t,i,a,u,l,n,s,o,c;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.service,i=r.target,a=r.seconds,(u=r.command).$identity=_identity.default.system,u.$scheduler=new _schedule.default({service:t,target:i}),l=d.client.queuePath(d.project,d.location,d.queue),n={httpRequest:{httpMethod:"POST",url:d.deliveryUrl,body:Buffer.from(JSON.stringify(u)).toString("base64")}},a&&(n.scheduleTime={seconds:Date.now()/1e3+a}),e.prev=6,console.log("creating gcloud task",n),e.next=10,d.client.createTask({parent:l,task:n});case 10:s=e.sent,o=(0,_slicedToArray2.default)(s,1),c=o[0],console.log("created gcloud task",c),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),console.error("Error creating Gcloud Task",e.t0);case 19:case"end":return e.stop()}},e,null,[[6,16]])}));return function(e){return r.apply(this,arguments)}}()),this.project=i,this.queue=a,this.location=u,this.deliveryUrl=t,this.client=new _tasks.v2beta3.CloudTasksClient({credentials:l})};exports.default=TaskScheduler;
//# sourceMappingURL=../maps/commandScheduling/taskScheduler.js.map
