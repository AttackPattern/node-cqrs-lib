"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_url=_interopRequireDefault(require("url")),RestCommandDeliverer=function(){function a(e,r,t){var s=this;(0,_classCallCheck2.default)(this,a),(0,_defineProperty2.default)(this,"deliver",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){var t,a,n,i,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.service,a=r.target,n=r.command,i=s.formatCommandUrl({service:t,target:a,command:n.type}),e.next=4,s.getSystemIdentity();case 4:return o=e.sent,e.next=7,s.fetch(i,{method:"POST",headers:{"Content-Type":"application/json",authorization:o,position:n.$position&&Buffer.from(JSON.stringify(n.$position)).toString("base64")},body:JSON.stringify(n)});case 7:return e.abrupt("return",e.sent.json());case 8:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}()),this.baseUrl=_url.default.parse(e+(e.endsWith("/")?"":"/")),this.fetch=r,this.getSystemIdentity=t}return(0,_createClass2.default)(a,[{key:"formatCommandUrl",value:function(e){var r=e.service,t=e.target,a=e.command;return _url.default.format({protocol:this.baseUrl.protocol,host:this.baseUrl.host,pathname:"".concat(this.baseUrl.pathname).concat(r?r+"/":"").concat(t?t+"/":"").concat(a)})}}]),a}();exports.default=RestCommandDeliverer;
//# sourceMappingURL=../maps/commandScheduling/restCommandDeliverer.js.map
